<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Consulta de Stock | Calzados Morales</title>
    <link rel="stylesheet" th:href="@{/assets/vendors/mdi/css/materialdesignicons.min.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/css/vendor.bundle.base.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <link rel="shortcut icon" th:href="@{/assets/images/favicon.png}" />
    
    <style>
        /* Forzar que inputs y botones midan lo mismo */
        .custom-height {
            height: 45px !important;
        }
        
        /* Línea separadora solicitada: gris visible y con margen */
        .linea-visible {
            border-top: 1.5px solid #d1d3e2 !important; 
            opacity: 1;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        /* Ajuste para que el texto de los botones esté centrado */
        .btn-icon-text {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container-scroller">
        <nav th:replace="~{fragmentos/navbar :: navbar}"></nav>
        
        <div class="container-fluid page-body-wrapper">
            <nav th:replace="~{fragmentos/sidebar :: sidebar}"></nav>

            <div class="main-panel">
                <div class="content-wrapper">
                    
                    <div class="page-header">
                        <h3 class="page-title">
                            <span class="page-title-icon bg-gradient-primary text-white me-2">
                                <i class="mdi mdi-archive"></i>
                            </span> Consulta de Stock Real
                        </h3>
                    </div>

                    <div class="row">
                        <div class="col-12 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Filtros De Búsqueda</h4>
                                    <hr class="linea-visible"> <form th:action="@{/productos/consulta-stock}" method="get">
                                        <div class="row align-items-end">
                                            <div class="col-md-4">
                                                <div class="form-group mb-0">
                                                    <label class="text-muted font-weight-bold">Categoría:</label>
                                                    <select name="idCat" class="form-control custom-height">
                                                        <option value="0">-- Todas las Categorías --</option>
                                                        <option th:each="cat : ${listaCategorias}" 
                                                                th:value="${cat.id_categoria}" 
                                                                th:text="${cat.nombre}"
                                                                th:selected="${cat.id_categoria == idCategoriaSeleccionada}">
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group mb-0">
                                                    <label class="text-muted font-weight-bold">Talla:</label>
                                                    <input type="text" name="talla" class="form-control custom-height" 
                                                           placeholder="Ej: 39" th:value="${tallaFiltro}">
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="d-flex">
                                                    <button type="submit" class="btn btn-gradient-primary btn-icon-text me-2 custom-height flex-fill">
                                                        <i class="mdi mdi-magnify btn-icon-prepend"></i> Buscar
                                                    </button>
                                                    
                                                    <a th:href="@{/productos/consulta-stock}" 
                                                       class="btn btn-secondary btn-icon-text custom-height flex-fill" 
                                                       style="background-color: #e4e6eb; color: #3e4b5b; border: none;">
                                                        <i class="mdi mdi-refresh btn-icon-prepend"></i> Limpiar
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Existencias En Almacén</h4>
                                    <hr class="linea-visible"> <div class="table-responsive">
                                        <table class="table table-hover table-bordered">
                                            <thead class="bg-light">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Producto</th>
                                                    <th>Categoría</th>
                                                    <th>Talla</th>
                                                    <th>Color</th>
                                                    <th>Precio</th>
                                                    <th>Stock</th>
                                                    <th>Estado</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="p : ${listaResultados}">
                                                    <td th:text="${p.id_producto}"></td>
                                                    <td class="font-weight-bold" th:text="${p.nombre}"></td>
                                                    <td th:text="${p.categoria.nombre}"></td>
                                                    <td th:text="${p.talla.nombre}"></td>
                                                    <td th:text="${p.color.nombre}"></td>
                                                    <td>
                                                        <span th:text="'S/ ' + ${#numbers.formatDecimal(p.precio, 1, 'POINT', 2, 'COMMA')}"></span>
                                                    </td>
                                                    <td class="text-center">
                                                        <mark class="bg-light font-weight-bold" th:text="${p.stock}"></mark>
                                                    </td>
                                                    <td>
                                                        <span th:if="${p.stock <= 0}" class="badge badge-danger">AGOTADO</span>
                                                        <span th:if="${p.stock > 0 and p.stock <= 5}" class="badge badge-warning text-dark">BAJO STOCK</span>
                                                        <span th:if="${p.stock > 5}" class="badge badge-success">DISPONIBLE</span>
                                                    </td>
                                                </tr>
                                                
                                                <tr th:if="${#lists.isEmpty(listaResultados)}">
                                                    <td colspan="8" class="text-center text-muted py-4">
                                                        <i class="mdi mdi-alert-circle-outline"></i> No se encontraron productos con los filtros seleccionados.
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <footer class="footer">
                    <div class="d-sm-flex justify-content-center justify-content-sm-between">
                        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright © 2026 Calzados Morales</span>
                    </div>
                </footer>
            </div> </div> </div> <script th:src="@{/assets/vendors/js/vendor.bundle.base.js}"></script>
    <script th:src="@{/assets/js/off-canvas.js}"></script>
    <script th:src="@{/assets/js/hoverable-collapse.js}"></script>
    <script th:src="@{/assets/js/misc.js}"></script>
</body>
</html>